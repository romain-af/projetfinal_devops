<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    li { margin-bottom: 8px; }
    button { margin-left: 5px; }
  </style>
</head>
<body>
  <h1>Task Manager</h1>
  <form id="taskForm">
    <input type="text" id="title" placeholder="Titre de la tâche" required>
    <input type="text" id="description" placeholder="Description">
    <button type="submit">Ajouter</button>
  </form>
  <h2>Liste des tâches</h2>
  <ul id="taskList"></ul>

  <script>
    // Fonction pour afficher les tâches dans la liste
    function afficherTaches(taches) {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';
      taches.forEach(tache => {
        const li = document.createElement('li');
        li.textContent = `${tache.title} : ${tache.description} ${tache.completed ? "(Terminé)" : ""}`;
        
        // Bouton pour supprimer la tâche
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = "Supprimer";
        deleteBtn.onclick = function() {
          deleteTask(tache.id);
        };
        li.appendChild(deleteBtn);

        // Bouton pour basculer le statut "terminé"
        const completeBtn = document.createElement('button');
        completeBtn.textContent = tache.completed ? "Marquer comme non terminé" : "Marquer comme terminé";
        completeBtn.onclick = function() {
          toggleComplete(tache);
        };
        li.appendChild(completeBtn);

        taskList.appendChild(li);
      });
    }

    // Récupérer les tâches depuis le backend
    function fetchTasks() {
      fetch('http://localhost:8000/tasks')
        .then(response => response.json())
        .then(data => afficherTaches(data))
        .catch(error => console.error('Erreur lors de la récupération des tâches :', error));
    }

    // Gestion de l'envoi du formulaire pour ajouter une tâche
    document.getElementById('taskForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const id = Date.now(); // Utilise l'horodatage comme identifiant
      const task = { id, title, description, completed: false };

      fetch('http://localhost:8000/tasks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(task)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Tâche ajoutée :', data);
        fetchTasks();
      })
      .catch(error => console.error('Erreur lors de l’ajout de la tâche :', error));
    });

    // Fonction pour supprimer une tâche
    function deleteTask(taskId) {
      fetch(`http://localhost:8000/tasks/${taskId}`, {
        method: 'DELETE'
      })
      .then(response => response.json())
      .then(data => {
        console.log('Tâche supprimée :', data);
        fetchTasks();
      })
      .catch(error => console.error('Erreur lors de la suppression de la tâche :', error));
    }

    // Fonction pour basculer le statut "terminé" d'une tâche
    function toggleComplete(task) {
      const updatedTask = { ...task, completed: !task.completed };
      fetch(`http://localhost:8000/tasks/${task.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedTask)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Tâche mise à jour :', data);
        fetchTasks();
      })
      .catch(error => console.error('Erreur lors de la mise à jour de la tâche :', error));
    }

    // Charger les tâches dès le chargement de la page
    fetchTasks();
  </script>
</body>
</html>
